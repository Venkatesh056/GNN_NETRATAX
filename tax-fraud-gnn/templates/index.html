<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Fraud Detection Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .container {
            flex: 1;
        }
        
        footer {
            margin-top: auto;
        }
        
        .charts-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: var(--white);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            min-height: 420px;
        }
        
        .chart-container h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <h1>ğŸš¨ Tax Fraud Detection</h1>
                <p>Graph Neural Network-based Analysis</p>
            </div>
            <ul class="navbar-menu">
                <li><a href="/" class="nav-link">Dashboard</a></li>
                <li><a href="/companies" class="nav-link">Companies</a></li>
                <li><a href="/analytics" class="nav-link">Analytics</a></li>
                <li><a href="/upload" class="nav-link">Upload</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <h2>ğŸ“Š Dashboard Overview</h2>
            <p>Real-time fraud detection statistics and risk analysis powered by Graph Neural Networks</p>
        </div>

        <!-- Key Metrics - Single Row -->
        <div class="metrics-grid-single-row">
            <div class="metric-card">
                <div class="metric-value">{{ total_companies }}</div>
                <div class="metric-label">Total Companies</div>
                <div class="metric-icon">ğŸ“Š</div>
            </div>

            <div class="metric-card metric-high-risk">
                <div class="metric-value">{{ high_risk_count }}</div>
                <div class="metric-label">High-Risk Companies</div>
                <div class="metric-icon">ğŸ”´</div>
            </div>

            <div class="metric-card metric-fraud">
                <div class="metric-value">{{ fraud_count }}</div>
                <div class="metric-label">Predicted Fraud Cases</div>
                <div class="metric-icon">âš ï¸</div>
            </div>

            <div class="metric-card metric-risk">
                <div class="metric-value">{{ avg_risk }}</div>
                <div class="metric-label">Average Risk Score</div>
                <div class="metric-icon">ğŸ“ˆ</div>
            </div>
        </div>

        <!-- Charts Row 1: Fraud & Risk Distribution -->
        <div class="charts-row">
            <div class="chart-container">
                <h3>ğŸ“Š Fraud Distribution</h3>
                <div id="fraudDistributionChart"></div>
            </div>

            <div class="chart-container">
                <h3>ğŸ“‰ Risk Score Distribution</h3>
                <div id="riskDistributionChart"></div>
            </div>
        </div>

        <!-- Charts Row 2: Risk by Location -->
        <div class="charts-row" style="grid-column: 1 / -1;">
            <div class="chart-container" style="grid-column: 1 / -1;">
                <h3>ğŸ—ºï¸ Risk by Location</h3>
                <div id="riskByLocationChart" style="height: 420px;"></div>
            </div>
        </div>

        <!-- Charts Row 3: Turnover vs Risk -->
        <div class="charts-row" style="grid-column: 1 / -1;">
            <div class="chart-container" style="grid-column: 1 / -1;">
                <h3>ğŸ’° Company Turnover vs Fraud Risk</h3>
                <div id="turnoverVsRiskChart" style="height: 420px;"></div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 Tax Fraud Detection System | SIH Project | Powered by Graph Neural Networks</p>
    </footer>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script>
        // Initialize dashboard on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard loading...');
            setTimeout(() => {
                loadFraudDistributionChart();
                loadRiskDistributionChart();
                loadRiskByLocationChart();
                loadTurnoverVsRiskChart();
            }, 300);
        });
        
        // Handle window resize for responsive charts
        window.addEventListener('resize', () => {
            ['fraudDistributionChart', 'riskDistributionChart', 'riskByLocationChart', 'turnoverVsRiskChart'].forEach(id => {
                if (document.getElementById(id)) {
                    Plotly.Plots.resize(id);
                }
            });
        });
    </script>
</body>
</html>
